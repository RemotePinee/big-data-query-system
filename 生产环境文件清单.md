# 生产环境文件清单

## 📋 概述

本文档详细列出了前后端项目中各个文件在生产环境中的必要性，帮助优化部署包大小和提高安全性。

## 🔧 后端文件分析

### ✅ 生产环境必须文件

| 文件/目录 | 用途 | 说明 |
|-----------|------|------|
| `dist/` | 编译后的JavaScript代码 | **核心必须**，包含所有运行时代码 |
| `package.json` | 项目配置和依赖声明 | **必须**，npm/yarn需要读取依赖信息 |
| `package-lock.json` | 依赖版本锁定 | **强烈建议**，确保依赖版本一致性 |
| `.env` | 生产环境变量配置 | **必须**，包含数据库连接、JWT密钥等 |
| `sql/` | 数据库初始化脚本 | **必须**，生产环境数据库初始化 |
| `uploads/` | 用户上传文件目录 | **必须**，存储系统Logo、用户头像等 |
| `cleanup-task.js` | 定时清理任务脚本 | **必须**，宝塔面板计划任务调用 |

### ❌ 生产环境不需要文件

| 文件/目录 | 用途 | 为什么不需要 |
|-----------|------|-------------|
| `src/` | TypeScript源代码 | 已编译到dist/，源码不需要 |
| `tsconfig.json` | TypeScript编译配置 | 编译完成后不需要 |
| `.env.example` | 环境变量示例文件 | 仅用于开发参考，生产环境有实际.env |

### 🔄 可选文件（根据需求决定）

| 文件/目录 | 用途 | 建议 |
|-----------|------|------|
| `node_modules/` | 依赖包 | 生产环境重新安装，不建议直接复制 |

## 🎨 前端文件分析

### ✅ 生产环境必须文件

| 文件/目录 | 用途 | 说明 |
|-----------|------|------|
| `dist/` | 构建后的静态文件 | **核心必须**，包含HTML、CSS、JS等 |
| `package.json` | 项目配置 | **必须**，部署脚本可能需要 |
| `package-lock.json` | 依赖版本锁定 | **建议保留**，便于问题排查 |
| `.env.production` | 生产环境变量 | **必须**，API地址等配置 |

### ❌ 生产环境不需要文件

| 文件/目录 | 用途 | 为什么不需要 |
|-----------|------|-------------|
| `src/` | Vue源代码 | 已构建到dist/，源码不需要 |
| `public/` | 开发时静态资源 | 已复制到dist/，原始文件不需要 |
| `index.html` | 开发模板 | 已处理到dist/index.html |
| `vite.config.ts` | Vite构建配置 | 构建完成后不需要 |
| `tsconfig.json` | TypeScript配置 | 构建完成后不需要 |
| `tsconfig.node.json` | Node.js TypeScript配置 | 构建完成后不需要 |
| `.env.development` | 开发环境变量 | 生产环境不需要 |

### 🔄 可选文件

| 文件/目录 | 用途 | 建议 |
|-----------|------|------|
| `node_modules/` | 依赖包 | 生产环境不需要，仅构建时使用 |

## 📦 生产环境部署建议

### 后端部署包结构
```
backend/
├── dist/                 # ✅ 必须
├── package.json          # ✅ 必须
├── package-lock.json     # ✅ 建议
├── .env                  # ✅ 必须（需配置生产参数）
├── sql/                  # ✅ 必须
├── uploads/              # ✅ 必须
├── cleanup-task.js       # ✅ 必须
└── logs/                 # 🔄 运行时创建
```

### 前端部署包结构
```
frontend/
└── dist/                 # ✅ 只需要这个目录的内容
    ├── index.html
    ├── assets/
    ├── js/
    ├── css/
    └── ...
```

## 🚀 部署优化建议

### 1. 后端部署步骤
```bash
# 1. 上传必要文件
rsync -av --exclude='src' --exclude='node_modules' backend/ server:/path/to/backend/

# 2. 安装生产依赖
cd /path/to/backend
npm ci --only=production

# 3. 创建必要目录
mkdir -p logs

# 4. 启动服务
pm2 start ecosystem.config.js
```

### 2. 前端部署步骤
```bash
# 1. 本地构建
cd frontend
npm run build

# 2. 上传构建文件
rsync -av dist/ server:/var/www/html/

# 3. 配置Web服务器（Nginx/Apache）
```

### 3. 文件权限设置
```bash
# 后端文件权限
chmod 755 /path/to/backend
chmod 644 /path/to/backend/.env
chmod 755 /path/to/backend/cleanup-task.js
chmod -R 755 /path/to/backend/uploads

# 前端文件权限
chmod -R 644 /var/www/html/*
chmod 755 /var/www/html
```

## 🔒 安全注意事项

### 1. 敏感文件保护
- `.env` 文件包含敏感信息，确保权限设置正确
- 不要将 `.env` 文件提交到版本控制系统
- 定期更新JWT密钥和数据库密码

### 2. 文件清理
- 定期清理日志文件，避免磁盘空间不足
- 清理临时文件和缓存
- 监控uploads目录大小

### 3. 备份策略
- 定期备份 `.env` 配置文件
- 备份 `uploads/` 用户数据
- 备份数据库和重要配置

## 📊 磁盘空间优化

### 开发环境 vs 生产环境文件大小对比

| 组件 | 开发环境 | 生产环境 | 节省空间 |
|------|----------|----------|----------|
| 后端 | ~200MB | ~50MB | 75% |
| 前端 | ~150MB | ~5MB | 97% |
| 总计 | ~350MB | ~55MB | 84% |

### 空间优化技巧
1. **删除源码**：src目录通常占用最多空间
2. **清理依赖**：node_modules在生产环境重新安装
3. **压缩资源**：启用gzip压缩
4. **图片优化**：压缩上传的图片文件

## 🔍 文件完整性检查

### 部署后检查清单
- [ ] 后端服务能正常启动
- [ ] 前端页面能正常访问
- [ ] 数据库连接正常
- [ ] 文件上传功能正常
- [ ] 定时任务脚本可执行
- [ ] 日志文件正常生成
- [ ] 环境变量配置正确

---

**最后更新**: 2025-01-24  
**版本**: v1.0  
**适用环境**: 生产环境部署