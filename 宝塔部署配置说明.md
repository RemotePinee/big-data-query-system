# 宝塔面板部署配置说明

## 问题分析

您遇到的"前端一直显示加载中的预载入动画"问题，主要原因可能包括：

1. **JavaScript执行失败** - 生产环境中JS文件加载或执行出错
2. **API请求失败** - 前端无法正确访问后端API接口
3. **静态资源路径问题** - 资源文件路径配置不正确

## 解决方案

### 1. 前端加载动画修复

已修改 `index.html` 文件，添加了更健壮的加载动画隐藏机制：
- 多种触发条件确保动画被隐藏
- 最大10秒超时保护
- 错误处理机制

### 2. 宝塔面板Nginx配置

在宝塔面板中，需要配置Nginx反向代理，将API请求转发到后端服务器：

```nginx
# 在网站配置中添加以下location规则
location /api/ {
    proxy_pass http://localhost:3000/api/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # 处理跨域
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods 'GET, POST, PUT, DELETE, OPTIONS';
    add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';
    
    if ($request_method = 'OPTIONS') {
        return 204;
    }
}

# 前端路由支持（SPA应用）
location / {
    try_files $uri $uri/ /index.html;
}
```

### 3. 部署步骤

1. **构建前端项目**
   ```bash
   cd frontend
   npm run build
   ```

2. **上传dist文件夹内容到宝塔网站根目录**

3. **确保后端服务运行在3000端口**
   ```bash
   cd backend
   npm start
   ```

4. **配置Nginx反向代理**（如上所示）

5. **重启Nginx服务**

### 4. 环境变量检查

确保生产环境配置正确：

**frontend/.env.production**
```
VITE_API_BASE_URL=/api
VITE_APP_TITLE=大数据查询系统
VITE_APP_ENV=production
```

### 5. 常见问题排查

1. **检查浏览器控制台**
   - 查看是否有JS错误
   - 检查网络请求是否成功
   - 确认API请求路径是否正确

2. **检查后端服务**
   - 确认后端服务正常运行
   - 检查端口3000是否被占用
   - 查看后端日志是否有错误

3. **检查Nginx配置**
   - 确认反向代理配置正确
   - 检查Nginx错误日志
   - 测试API接口是否可访问

### 6. 测试验证

部署完成后，可以通过以下方式验证：

1. 访问前端页面，检查是否正常加载
2. 打开浏览器开发者工具，查看网络请求
3. 测试登录功能是否正常
4. 检查API接口响应是否正确

## 注意事项

- 确保前后端服务都正常运行
- 检查防火墙设置，确保端口可访问
- 如果使用域名，确保DNS解析正确
- 定期检查服务器资源使用情况